(function(e,t,n){"use strict";var r={html:'<!DOCTYPE html><html><head><style>.ie * {min-height: auto !important}</style><meta http-equiv="Content-Type" content="text/html;charset={charset}" /><link rel="stylesheet" type="text/css" href="{style}" /></head><body contenteditable="true"></body></html>',toolbarButton:'<a class="sceditor-button sceditor-button-{name}" data-sceditor-command="{name}" unselectable="on"><div unselectable="on">{dispName}</div></a>',emoticon:'<img src="{url}" data-sceditor-emoticon="{key}" alt="{key}" />',fontOpt:'<a class="sceditor-font-option" href="#" data-font="{font}"><font face="{font}">{font}</font></a>',sizeOpt:'<a class="sceditor-fontsize-option" data-size="{size}" href="#"><font size="{size}">{size}</font></a>',pastetext:'<div><label for="txt">{label}</label> <textarea cols="20" rows="7" id="txt"></textarea></div><div><input type="button" class="button" value="{insert}" /></div>',table:'<div><label for="rows">{rows}</label><input type="text" id="rows" value="2" /></div><div><label for="cols">{cols}</label><input type="text" id="cols" value="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',image:'<div><label for="link">{url}</label> <input type="text" id="image" value="http://" /></div><div><label for="width">{width}</label> <input type="text" id="width" size="2" /></div><div><label for="height">{height}</label> <input type="text" id="height" size="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',email:'<div><label for="email">{label}</label> <input type="text" id="email" /></div><div><input type="button" class="button" value="{insert}" /></div>',link:'<div><label for="link">{url}</label> <input type="text" id="link" value="http://" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{ins}" /></div>',youtubeMenu:'<div><label for="link">{label}</label> <input type="text" id="link" value="http://" /></div><div><input type="button" class="button" value="{insert}" /></div>',youtube:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{id}?wmode=opaque" data-youtube-id="{id}" frameborder="0" allowfullscreen></iframe>'},i=function(t,n,i){var s=r[t];return e.each(n,function(e,t){s=s.replace(new RegExp("\\{"+e+"\\}","g"),t)}),i&&(s=e(s)),s};e.sceditor=function(r,s){var o=this,u=r.get?r.get(0):r,a=e(u),f,l,c,h,p,d,v,m=[],g,y,b=[],w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W;o.commands=e.extend({},s.commands||e.sceditor.commands),S=function(){a.data("sceditor",o),o.opts=e.extend({},e.sceditor.defaultOptions,s),o.opts.locale&&o.opts.locale!=="en"&&q();var r=o.opts.height,i=o.opts.width;(r&&(r+"").indexOf("%")>-1||i&&(i+"").indexOf("%")>-1)&&e(t).resize(I),f=e('<div class="sceditor-container" />').insertAfter(a),_(),M(),D(),o.opts.resizeEnabled&&P(),o.opts.id&&f.attr("id",o.opts.id),e(n).click(H),e(u.form).attr("novalidate","novalidate").bind("reset",A).submit(B),o.val(a.hide().val()),o.opts.autofocus&&W(),e.sceditor.isWysiwygSupported||o.toggleSourceMode(),o.opts.toolbar.indexOf("emoticon")!==-1&&j();if(o.opts.autoExpand)var l=setInterval(function(){if(!n.readyState||n.readyState==="complete")o.expandToContent(),clearInterval(l)},10)},M=function(){var n,r;p=e("<textarea></textarea>").hide(),c=e('<iframe frameborder="0"></iframe>'),t.location.protocol==="https:"&&c.attr("src","javascript:false"),f.append(c).append(p),h=c[0],d=p[0],o.width(o.opts.width||a.width()),o.height(o.opts.height||a.height()),F().open(),F().write(i("html",{charset:o.opts.charset,style:o.opts.style})),F().close(),o.readOnly(!!o.opts.readOnly),n=e(F()),r=n.find("body"),e.sceditor.ie&&n.find("html").addClass("ie").addClass("ie"+e.sceditor.ie),(/iPhone|iPod|iPad| wosbrowser\//i.test(navigator.userAgent)||e.sceditor.ie)&&r.height("100%"),r.keypress(L).keyup(z),n.keypress(L).mousedown(O).bind("beforedeactivate keyup",N).keyup(z).focus(function(){g=null}),o.opts.autoUpdate&&(r.bind("blur",o.updateOriginal),n.bind("blur",o.updateOriginal)),o.opts.rtl&&(r.attr("dir","rtl"),p.attr("dir","rtl")),o.opts.enablePasteFiltering&&r.bind("paste",C),o.opts.autoExpand&&n.bind("keyup",o.expandToContent),w=new e.sceditor.rangeHelper(h.contentWindow)},_=function(){var t,n,r,s,u,a,c=o.opts.toolbar.split("|");a=function(){var t=e(this);return t.hasClass("disabled")||T(t,o.commands[t.data("sceditor-command")]),!1},l=e('<div class="sceditor-toolbar" />');for(s=0;s<c.length;s++){t=e('<div class="sceditor-group" />'),r=c[s].split(",");for(u=0;u<r.length;u++){if(!o.commands[r[u]])continue;n=i("toolbarButton",{name:r[u],dispName:o.commands[r[u]].tooltip||r[u]},!0).click(a).data("sceditor-txtmode",!!o.commands[r[u]].txtExec).data("sceditor-wysiwygmode",!!o.commands[r[u]].exec),o.commands[r[u]].tooltip&&n.attr("title",o._(o.commands[r[u]].tooltip)),o.commands[r[u]].exec||n.addClass("disabled"),t.append(n)}l.append(t)}o.opts.toolbarContainer?e(o.opts.toolbarContainer).append(l):f.append(l)},W=function(){var e,t=h.contentWindow.document,n=t.body;if(!t.createRange)return o.focus();if(!n.firstChild)return;e=t.createRange(),e.setStart(n.firstChild,0),e.setEnd(n.firstChild,0),w.selectRange(e),n.focus()},o.readOnly=function(e){return typeof e!="boolean"?p.attr("readonly")==="readonly":(F().body.contentEditable=!e,e?p.attr("readonly","readonly"):p.removeAttr("readonly"),R(e),this)},R=function(t){var n=o.inSourceMode();l.find(".sceditor-button").removeClass("disabled").each(function(){var r=e(this);t===!0||n&&!r.data("sceditor-txtmode")?r.addClass("disabled"):!n&&!r.data("sceditor-wysiwygmode")&&r.addClass("disabled")})},D=function(){e.each(o.commands,function(e,t){t.keyPress&&m.push(t.keyPress)})},o.width=function(e){return e?(o.width()!==e&&(f.width(e),c.width(e),c.width(e+(e-c.outerWidth(!0))),p.width(e),p.width(e+(e-p.outerWidth(!0)))),this):f.width()},o.height=function(e){return e?(o.height()!==e&&(f.height(e),e-=o.opts.toolbarContainer?0:l.outerHeight(!0),c.height(e),c.height(e+(e-c.outerHeight(!0))),p.height(e),p.height(e+(e-p.outerHeight(!0)))),this):f.height()},o.expandToContent=function(e){var t=F(),n=f.height(),r=t.body.scrollHeight||t.documentElement.scrollHeight,i=n-c.height(),s=o.opts.resizeMaxHeight||(o.opts.height||a.height())*2;r+=i,e!==!0&&r>s&&(r=s),r>n&&o.height(r)},P=function(){var t,r,i,s,u,a=e('<div class="sceditor-grip" />'),l=e('<div class="sceditor-resize-cover" />'),c=0,h=0,p=0,d=0,v=f.width(),m=f.height(),g=!1;t=o.opts.resizeMinHeight||m/1.5,r=o.opts.resizeMaxHeight||m*2.5,i=o.opts.resizeMinWidth||v/1.25,s=o.opts.resizeMaxWidth||v*1.25,u=function(e){var n=d+(e.pageY-h),u=p+(e.pageX-c);s>0&&u>s&&(u=s),r>0&&n>r&&(n=r),o.opts.resizeWidth&&u>=i&&(s<0||u<=s)&&o.width(u),o.opts.resizeHeight&&n>=t&&(r<0||n<=r)&&o.height(n),e.preventDefault()},f.append(a),f.append(l.hide()),a.mousedown(function(t){c=t.pageX,h=t.pageY,p=f.width(),d=f.height(),g=!0,f.addClass("resizing"),l.show(),e(n).bind("mousemove",u),t.preventDefault()}),e(n).mouseup(function(t){if(!g)return;g=!1,l.hide(),f.removeClass("resizing"),e(n).unbind("mousemove",u),t.preventDefault()})},B=function(t){o.updateOriginal(),e(this).removeAttr("novalidate"),this.checkValidity&&!this.checkValidity()&&t.preventDefault(),e(this).attr("novalidate","novalidate"),o.blur()},o.destroy=function(){e(n).unbind("click",H),e(t).unbind("resize",I),e(u.form).removeAttr("novalidate").unbind("submit",B).unbind("reset",A),e(F()).find("*").remove(),e(F()).unbind("keypress mousedown beforedeactivate keyup focus paste keypress"),f.find("*").remove(),f.remove(),a.removeData("sceditor").removeData("sceditorbbcode").show()},j=function(){o.opts.emoticonsRoot&&o.opts.emoticons&&e.each(o.opts.emoticons,function(t,n){e.each(n,function(e,n){o.opts.emoticons[t][e]=o.opts.emoticonsRoot+n})});var t=e.extend({},o.opts.emoticons.more,o.opts.emoticons.dropdown,o.opts.emoticons.hidden),r;e.each(t,function(e,t){r=n.createElement("img"),r.src=t,b.push(r)})},o.createDropDown=function(t,n,r,i){o.closeDropDown(),i!==!1&&e(r).find(":not(input,textarea)").filter(function(){return this.nodeType===1}).attr("unselectable","on");var s={top:t.offset().top,left:t.offset().left,marginTop:t.outerHeight()};e.extend(s,o.opts.dropDownCss),v=e('<div class="sceditor-dropdown sceditor-'+n+'" />').css(s).append(r).appendTo(e("body")).click(function(e){e.stopPropagation()})},H=function(e){e.which!==3&&o.closeDropDown()},C=function(e){function a(e,t){if(e.childNodes.length>0){while(e.firstChild)t.appendChild(e.firstChild);while(u.firstChild)e.appendChild(u.firstChild);k(e,t)}else{if(i>25){while(u.firstChild)e.appendChild(u.firstChild);w.restoreRange();return}++i,setTimeout(function(){a(e,t)},20)}}var t,r=F().body,i=0,s=r.ownerDocument.createElement("div"),u=r.ownerDocument.createDocumentFragment();w.saveRange(),n.body.appendChild(s);if(e&&e.clipboardData&&e.clipboardData.getData)if((t=e.clipboardData.getData("text/html"))||(t=e.clipboardData.getData("text/plain")))return s.innerHTML=t,k(r,s),e.stopPropagation(),e.preventDefault(),!1;while(r.firstChild)u.appendChild(r.firstChild);return a(r,s),o.focus(),!0},k=function(t,n){e.sceditor.dom.fixNesting(n);var r=n.innerHTML;o.opts.getHtmlHandler&&(r=o.opts.getHtmlHandler(r,e(n))),n.parentNode.removeChild(n),o.opts.getTextHandler&&(r=o.opts.getTextHandler(r,!0)),w.restoreRange(),w.insertHTML(r)},o.closeDropDown=function(e){v&&(v.off().remove(),v=null),e===!0&&o.focus()},F=function(){return h.contentDocument?h.contentDocument:h.contentWindow&&h.contentWindow.document?h.contentWindow.document:h.document?h.document:null},o.wysiwygEditorInsertHtml=function(t,n,r){o.focus();if(!r&&(e(w.parentNode()).is("code")||e(w.parentNode()).parents("code").length!==0))return;w.insertHTML(t,n),z()},o.wysiwygEditorInsertText=function(e,t){var n=function(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\r\n|\r/g,"\n").replace(/\n/g,"<br />"):e};o.wysiwygEditorInsertHtml(n(e),n(t))},o.insertText=function(e,t){return o.inSourceMode()?o.sourceEditorInsertText(e,t):o.wysiwygEditorInsertText(e,t),this},o.sourceEditorInsertText=function(e,t){var r,i,s,o,u;u=d.scrollTop,d.focus(),typeof d.selectionStart!="undefined"?(i=d.selectionStart,s=d.selectionEnd,o=e.length,t&&(e+=d.value.substring(i,s)+t),d.value=d.value.substring(0,i)+e+d.value.substring(s,d.value.length),t?d.selectionStart=i+e.length-t.length:d.selectionStart=i+e.length,d.selectionEnd=d.selectionStart):typeof n.selection.createRange!="undefined"?(r=n.selection.createRange(),t&&(e+=r.text+t),r.text=e,t&&r.moveEnd("character",0-t.length),r.moveStart("character",r.End-r.Start),r.select()):d.value+=e+t,d.scrollTop=u,d.focus()},o.getRangeHelper=function(){return w},o.val=function(e,t){return typeof e=="string"?(o.inSourceMode()?o.setSourceEditorValue(e):(t!==!1&&o.opts.getTextHandler&&(e=o.opts.getTextHandler(e)),o.setWysiwygEditorValue(e)),this):o.inSourceMode()?o.getSourceEditorValue(!1):o.getWysiwygEditorValue()},o.insert=function(t,n,r,i){if(o.inSourceMode())o.sourceEditorInsertText(t,n);else{if(n){var s=o.getRangeHelper().selectedHtml(),u=e("<div>").appendTo(e("body")).hide().html(s);r!==!1&&o.opts.getHtmlHandler&&(s=o.opts.getHtmlHandler(s,u),u.remove()),t+=s+n}r!==!1&&o.opts.getTextHandler&&(t=o.opts.getTextHandler(t,!0)),i!==!1&&(t=x(t)),o.wysiwygEditorInsertHtml(t)}return this},o.getWysiwygEditorValue=function(t){var n=c.contents().find("body"),r;return e.sceditor.ie&&o.focus(),w.saveRange(),e.sceditor.dom.fixNesting(n.get(0)),r=n.html(),t!==!1&&o.opts.getHtmlHandler&&(r=o.opts.getHtmlHandler(r,n)),w.restoreRange(),g=null,r},o.getSourceEditorValue=function(e){var t=p.val();return e!==!1&&o.opts.getTextHandler&&(t=o.opts.getTextHandler(t)),t},o.setWysiwygEditorValue=function(t){t||(t="<p>"+(e.sceditor.ie?"":"<br />")+"</p>"),F().body.innerHTML=x(t),z()},o.setSourceEditorValue=function(e){p.val(e)},o.updateOriginal=function(){a.val(o.val())},x=function(t){if(o.opts.toolbar.indexOf("emoticon")===-1)return t;var n=e.extend({},o.opts.emoticons.more,o.opts.emoticons.dropdown,o.opts.emoticons.hidden);return e.each(n,function(n,r){var s=e.sceditor.regexEscape(n)+"(?=([^\\<\\>]*?<(?!/code)|[^\\<\\>]*?$))",u="";o.opts.emoticonsCompat&&(s="((>|^|\\s| | | | |&nbsp;))"+s+"(?=(\\s|$|<| | | | |&nbsp;))",u="$1"),t=t.replace(new RegExp(s,"gm"),u+i("emoticon",{key:n,url:r}))}),t},o.inSourceMode=function(){return f.hasClass("sourceMode")},o.sourceMode=function(e){return typeof e!="boolean"?o.inSourceMode():((o.inSourceMode()&&!e||!o.inSourceMode()&&e)&&o.toggleSourceMode(),this)},o.toggleSourceMode=function(){if(!e.sceditor.isWysiwygSupported&&o.inSourceMode())return;o.inSourceMode()?o.setWysiwygEditorValue(o.getSourceEditorValue()):o.setSourceEditorValue(o.getWysiwygEditorValue()),g=null,p.toggle(),c.toggle(),o.inSourceMode()?f.removeClass("sourceMode").addClass("wysiwygMode"):f.removeClass("wysiwygMode").addClass("sourceMode"),R()},U=function(){d.focus();if(d.selectionStart!=null)return d.value.substring(d.selectionStart,d.selectionEnd);if(n.selection.createRange)return n.selection.createRange().text},T=function(t,n){if(o.inSourceMode()){n.txtExec&&(e.isArray(n.txtExec)?o.sourceEditorInsertText.apply(o,n.txtExec):n.txtExec.call(o,t,U()));return}if(!n.exec)return;e.isFunction(n.exec)?n.exec.call(o,t):o.execCommand(n.exec,n.hasOwnProperty("execParam")?n.execParam:null)},o.focus=function(){return o.inSourceMode()?d.focus():(h.contentWindow.focus(),g&&(w.selectRange(g),g=null)),this},o.blur=function(){return E||(E=e('<input style="width:0; height:0; opacity:0; filter: alpha(opacity=0)" type="text" />').appendTo(f)),E.removeAttr("disabled").focus().blur().attr("disabled","disabled"),this},N=function(){if(!e.sceditor.ie)return;g=w.selectedRange()},o.execCommand=function(t,n){var r=!1,i=e(w.parentNode());o.focus();if(i.is("code")||i.parents("code").length!==0)return;if(F())try{r=F().execCommand(t,!1,n)}catch(s){}!r&&o.commands[t]&&o.commands[t].errorMessage&&alert(o._(o.commands[t].errorMessage))},L=function(t){o.closeDropDown();var n=e(w.parentNode());if(t.which===13)if(n.is("code,blockquote,pre")||n.parents("code,blockquote,pre").length!==0)return g=null,o.wysiwygEditorInsertHtml("<br />",null,!0),!1;if(n.is("code")||n.parents("code").length!==0)return;var r=m.length;while(r--)m[r].call(o,t,h,p)},z=function(){var t,n,r=F();e.sceditor.dom.rTraverse(r.body,function(i){t=i.nodeName.toLowerCase();if(t==="code"||t==="blockquote")n=!0;if(i.nodeType===3&&!/^\s*$/.test(i.nodeValue)||i.nodeName.toLowerCase()==="br"||e.sceditor.ie&&!i.firstChild&&!e.sceditor.dom.isInline(i,!1))return n&&e(r.body).append(e("<div>"+(e.sceditor.ie?"":"<br />")+"</div>\n")),!1})},A=function(){o.val(a.val())},O=function(){o.closeDropDown(),g=null},I=function(){o.opts.height&&o.opts.height.toString().indexOf("%")>-1&&o.height(f.parent().height()*(parseFloat(o.opts.height)/100)),o.opts.width&&o.opts.width.toString().indexOf("%")>-1&&o.width(f.parent().width()*(parseFloat(o.opts.width)/100))},o._=function(){var e=arguments;return y&&y[e[0]]&&(e[0]=y[e[0]]),e[0].replace(/\{(\d+)\}/g,function(t,n){return typeof e[n-0+1]!="undefined"?e[n-0+1]:"{"+n+"}"})},q=function(){if(e.sceditor.locale[o.opts.locale])y=e.sceditor.locale[o.opts.locale];else{var t=o.opts.locale.split("-");e.sceditor.locale[t[0]]&&(y=e.sceditor.locale[t[0]])}y&&y.dateFormat&&(o.opts.dateFormat=y.dateFormat)},S()},e.sceditor.ie=function(){var e,r=3,i=n.createElement("div"),s=i.getElementsByTagName("i");do i.innerHTML="<!--[if gt IE "+ ++r+"]><i></i><![endif]-->";while(s[0]);return n.all&&t.atob&&(r=10),r>4?r:e}(),e.sceditor.isWysiwygSupported=function(){var t=e('<div contenteditable="true">')[0].contentEditable,n=typeof t!="undefined"&&t!=="inherit",r=navigator.userAgent,i;if(!n)return!1;var s=/Opera Mobi|Opera Mini/i.test(r);return/Android/i.test(r)&&(s=!0,/Safari/.test(r)&&(i=/Safari\/(\d+)/.exec(r),s=!i||!i[1]?!0:i[1]<534)),/ Silk\//i.test(r)&&(i=/AppleWebKit\/(\d+)/.exec(r),s=!i||!i[1]?!0:i[1]<534),/iPhone|iPod|iPad/i.test(r)&&(s=!/OS [5-9](_\d)+ like Mac OS X/i.test(r)),/fennec/i.test(r)&&(s=!1),!s}(),e.sceditor.regexEscape=function(e){return e.replace(/[\$\?\[\]\.\*\(\)\|\\]/g,"\\$&").replace("<","&lt;").replace(">","&gt;")},e.sceditor.locale={},e.sceditor.commands={bold:{exec:"bold",tooltip:"Bold"},italic:{exec:"italic",tooltip:"Italic"},underline:{exec:"underline",tooltip:"Underline"},strike:{exec:"strikethrough",tooltip:"Strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript"},superscript:{exec:"superscript",tooltip:"Superscript"},left:{exec:"justifyleft",tooltip:"Align left"},center:{exec:"justifycenter",tooltip:"Center"},right:{exec:"justifyright",tooltip:"Align right"},justify:{exec:"justifyfull",tooltip:"Justify"},font:{_dropDown:function(t,n,r){var s=t.opts.fonts.split(","),o=e("<div />"),u=function(){return r(e(this).data("font")),t.closeDropDown(!0),!1};for(var a=0;a<s.length;a++)o.append(i("fontOpt",{font:s[a]},!0).click(u));t.createDropDown(n,"font-picker",o)},exec:function(t){var n=this;e.sceditor.command.get("font")._dropDown(n,t,function(e){n.execCommand("fontname",e)})},tooltip:"Font Name"},size:{_dropDown:function(t,n,r){var s=e("<div />"),o=function(n){r(e(this).data("size")),t.closeDropDown(!0),n.preventDefault()};for(var u=1;u<=7;u++)s.append(i("sizeOpt",{size:u},!0).click(o));t.createDropDown(n,"fontsize-picker",s)},exec:function(t){var n=this;e.sceditor.command.get("size")._dropDown(n,t,function(e){n.execCommand("fontsize",e)})},tooltip:"Font Size"},color:{_dropDown:function(t,n,r){var i,s,o,u,a={r:255,g:255,b:255},f=e("<div />"),l=t.opts.colors?t.opts.colors.split("|"):new Array(21),c=[],h=e.sceditor.command.get("color");if(!h._htmlCache){for(i=0;i<l.length;++i){u=l[i]?l[i].split(","):new Array(21),c.push('<div class="sceditor-color-column">');for(s=0;s<u.length;++s)o=u[s]||"#"+a.r.toString(16)+a.g.toString(16)+a.b.toString(16),c.push('<a href="#" class="sceditor-color-option" style="background-color: '+o+'" data-color="'+o+'"></a>'),s%5===0?(a.g-=51,a.b=255):a.b-=51;c.push("</div>"),i%5===0?(a.r-=51,a.g=255,a.b=255):(a.g=255,a.b=255)}h._htmlCache=c.join("")}f.append(h._htmlCache).find("a").click(function(n){r(e(this).attr("data-color")),t.closeDropDown(!0),n.preventDefault()}),t.createDropDown(n,"color-picker",f)},exec:function(t){var n=this;e.sceditor.command.get("color")._dropDown(n,t,function(e){n.execCommand("forecolor",e)})},tooltip:"Font Color"},removeformat:{exec:"removeformat",tooltip:"Remove Formatting"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(e){var t,n=this,r=i("pastetext",{label:n._("Paste your text inside the following box:"),insert:n._("Insert")},!0);r.find(".button").click(function(e){t=r.find("#txt").val(),t&&n.wysiwygEditorInsertText(t),n.closeDropDown(!0),e.preventDefault()}),n.createDropDown(e,"pastetext",r)},tooltip:"Paste Text"},bulletlist:{exec:"insertunorderedlist",tooltip:"Bullet list"},orderedlist:{exec:"insertorderedlist",tooltip:"Numbered list"},table:{exec:function(t){var n=this,r=i("table",{rows:n._("Rows:"),cols:n._("Cols:"),insert:n._("Insert")},!0);r.find(".button").click(function(t){var i=r.find("#rows").val()-0,s=r.find("#cols").val()-0,o="<table>";if(i<1||s<1)return;for(var u=0;u<i;u++){o+="<tr>";for(var a=0;a<s;a++)o+="<td>"+(e.sceditor.ie?"":"<br />")+"</td>";o+="</tr>"}o+="</table>",n.wysiwygEditorInsertHtml(o),n.closeDropDown(!0),t.preventDefault()}),n.createDropDown(t,"inserttable",r)},tooltip:"Insert a table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{exec:function(){this.wysiwygEditorInsertHtml("<code>","<br /></code>")},tooltip:"Code"},image:{exec:function(e){var t=this,n=i("image",{url:t._("URL:"),width:t._("Width (optional):"),height:t._("Height (optional):"),insert:t._("Insert")},!0);n.find(".button").click(function(e){var r=n.find("#image").val(),i=n.find("#width").val(),s=n.find("#height").val(),o="";i&&(o+=' width="'+i+'"'),s&&(o+=' height="'+s+'"'),r&&r!=="http://"&&t.wysiwygEditorInsertHtml("<img"+o+' src="'+r+'" />'),t.closeDropDown(!0),e.preventDefault()}),t.createDropDown(e,"insertimage",n)},tooltip:"Insert an image"},email:{exec:function(e){var t=this,n=i("email",{label:t._("E-mail:"),insert:t._("Insert")},!0);n.find(".button").click(function(e){var r=n.find("#email").val();r&&(t.focus(),t.getRangeHelper().selectedHtml()?t.execCommand("createlink","mailto:"+r):t.wysiwygEditorInsertHtml('<a href="mailto:'+r+'">'+r+"</a>")),t.closeDropDown(!0),e.preventDefault()}),t.createDropDown(e,"insertemail",n)},tooltip:"Insert an email"},link:{exec:function(e){var t=this,n=i("link",{url:t._("URL:"),desc:t._("Description (optional):"),ins:t._("Insert")},!0);n.find(".button").click(function(e){var r=n.find("#link").val(),i=n.find("#des").val();r&&r!=="http://"&&(t.focus(),!t.getRangeHelper().selectedHtml()||i?(i||(i=r),t.wysiwygEditorInsertHtml('<a href="'+r+'">'+i+"</a>")):t.execCommand("createlink",r)),t.closeDropDown(!0),e.preventDefault()}),t.createDropDown(e,"insertlink",n)},tooltip:"Insert a link"},unlink:{exec:"unlink",tooltip:"Unlink"},quote:{exec:function(e,t,n){var r="<blockquote>",i="</blockquote>";t?(n=n?"<cite>"+n+"</cite>":"",r=r+n+t+i+"<br />",i=null):this.getRangeHelper().selectedHtml()===""&&(i="<br />"+i),this.wysiwygEditorInsertHtml(r,i)},tooltip:"Insert a Quote"},emoticon:{exec:function(t){var n,r=this,i=r.opts.emoticonsCompat?" ":"",s=e("<div />"),o=e("<div />");n=function(t,n){o.append(e("<img />").attr({src:n,alt:t}).click(function(t){r.insert(e(this).attr("alt")+i),r.closeDropDown(!0),t.preventDefault()})),o.children().length>3&&(s.append(o),o=e("<div />"))},e.each(r.opts.emoticons.dropdown,n),o.children().length>0&&s.append(o);if(r.opts.emoticons.more){var u=e(this._('<a class="sceditor-more">{0}</a>',this._("More"))).click(function(){var i=e.extend({},r.opts.emoticons.dropdown,r.opts.emoticons.more);return s=e("<div />"),e.each(i,n),o.children().length>0&&s.append(o),r.createDropDown(t,"insertemoticon",s),!1});s.append(u)}r.createDropDown(t,"insertemoticon",s)},txtExec:function(t){e.sceditor.command.get("emoticon").exec.call(this,t)},keyPress:function(t){if(this.opts.toolbar.indexOf("emoticon")===-1)return;var n=this,r=0,s=String.fromCharCode(t.which);n.EmoticonsCache||(n.EmoticonsCache=[],e.each(e.extend({},n.opts.emoticons.more,n.opts.emoticons.dropdown,n.opts.emoticons.hidden),function(e,t){n.EmoticonsCache[r++]=[e,i("emoticon",{key:e,url:t})]}),n.EmoticonsCache.sort(function(e,t){return e[0].length-t[0].length})),n.longestEmoticonCode||(n.longestEmoticonCode=n.EmoticonsCache[n.EmoticonsCache.length-1][0].length);if(n.getRangeHelper().raplaceKeyword(n.EmoticonsCache,!0,!0,n.longestEmoticonCode,n.opts.emoticonsCompat,s))return/^\s$/.test(s)&&n.opts.emoticonsCompat?!0:(t.preventDefault(),t.stopPropagation(),!1)},tooltip:"Insert an emoticon"},youtube:{_dropDown:function(e,t,n){var r,s=i("youtubeMenu",{label:e._("Video URL:"),insert:e._("Insert")},!0);s.find(".button").click(function(t){var i=s.find("#link").val().replace("http://","");i!==""&&(r=i.match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/),r&&(i=r[1]),/^[a-zA-Z0-9_\-]{11}$/.test(i)?n(i):alert("Invalid YouTube video")),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(t,"insertlink",s)},exec:function(t){var n=this;e.sceditor.command.get("youtube")._dropDown(n,t,function(e){n.wysiwygEditorInsertHtml(i("youtube",{id:e}))})},tooltip:"Insert a YouTube video"},date:{_date:function(e){var t=new Date,n=t.getYear(),r=t.getMonth()+1,i=t.getDate();return n<2e3&&(n=1900+n),r<10&&(r="0"+r),i<10&&(i="0"+i),e.opts.dateFormat.replace(/year/i,n).replace(/month/i,r).replace(/day/i,i)},exec:function(){this.insertText(e.sceditor.command.get("date")._date(this))},txtExec:function(){this.insertText(e.sceditor.command.get("date")._date(this))},tooltip:"Insert current date"},time:{_time:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();return t<10&&(t="0"+t),n<10&&(n="0"+n),r<10&&(r="0"+r),t+":"+n+":"+r},exec:function(){this.insertText(e.sceditor.command.get("time")._time())},txtExec:function(){this.insertText(e.sceditor.command.get("time")._time())},tooltip:"Insert current time"},ltr:{exec:function(){var t=this,n=t.getRangeHelper().getFirstBlockParent(),r=e(n);t.focus();if(!n||r.is("body")){t.execCommand("formatBlock","p"),n=t.getRangeHelper().getFirstBlockParent(),r=e(n);if(!n||r.is("body"))return}r.css("direction")==="ltr"?e(n).css("direction",""):e(n).attr("direction","ltr")},tooltip:"Left-to-Right"},rtl:{exec:function(){var t=this,n=t.getRangeHelper().getFirstBlockParent(),r=e(n);t.focus();if(!n||r.is("body")){t.execCommand("formatBlock","p"),n=t.getRangeHelper().getFirstBlockParent(),r=e(n);if(!n||r.is("body"))return}r.css("direction")==="rtl"?e(n).css("direction",""):e(n).css("direction","rtl")},tooltip:"Right-to-Left"},print:{exec:"print",tooltip:"Print"},source:{exec:function(){this.toggleSourceMode(),this.blur()},txtExec:function(){this.toggleSourceMode(),this.blur()},tooltip:"View source"},ignore:{}},e.sceditor.rangeHelper=function(t,n){var r,i,s,o,u,a,f=!0,l="sceditor-start-marker",c="sceditor-end-marker",h="character",p=this;s=function(e,t){i=t||e.contentDocument||e.document,r=e,f=!!e.getSelection}(t,n),p.insertHTML=function(e,t){var n,r,s=p.selectedRange();t&&(e+=p.selectedHtml()+t);if(f){r=i.createElement("div"),n=i.createDocumentFragment(),r.innerHTML=e;while(r.firstChild)n.appendChild(r.firstChild);p.insertNode(n)}else{if(!s)return!1;s.pasteHTML(e)}},p.insertNode=function(e,t){if(f){var n,r,s=i.createDocumentFragment(),o=p.selectedRange();if(!o)return!1;s.appendChild(e),t&&(s.appendChild(o.extractContents()),s.appendChild(t)),r=s.lastChild,o.deleteContents(),o.insertNode(s),n=i.createRange(),n.setStartAfter(r),p.selectRange(n)}else p.insertHTML(e.outerHTML,t?t.outerHTML:null)},p.cloneSelected=function(){var e=p.selectedRange();if(e)return f?e.cloneRange():e.duplicate()},p.selectedRange=function(){var e,t=f?r.getSelection():i.selection;if(!t)return;return t.getRangeAt&&t.rangeCount<=0&&(e=i.createRange(),e.setStart(i.body,0),t.addRange(e)),f?t.getRangeAt(0):t.createRange()},p.selectedHtml=function(){var e,t=p.selectedRange();return t?!f&&t.text!==""&&t.htmlText?t.htmlText:f?(e=i.createElement("div"),e.appendChild(t.cloneContents()),e.innerHTML):"":""},p.parentNode=function(){var e=p.selectedRange();if(e)return f?e.commonAncestorContainer:e.parentElement()},p.getFirstBlockParent=function(){var t=function(n){if(!e.sceditor.dom.isInline(n))return n;var r=n.parentNode;return r?t(r):null};return t(p.parentNode())},p.insertNodeAt=function(e,t){var n=p.cloneSelected();if(!n)return!1;n.collapse(e),n.insertNode?n.insertNode(t):n.pasteHTML(t.outerHTML)},o=function(e){p.removeMarker(e);var t=i.createElement("span");return t.id=e,t.style.lineHeight="0",t.style.display="none",t.className="sceditor-selection",t},p.insertMarkers=function(){p.insertNodeAt(!0,o(l)),p.insertNodeAt(!1,o(c))},p.getMarker=function(e){return i.getElementById(e)},p.removeMarker=function(e){var t=p.getMarker(e);t&&t.parentNode.removeChild(t)},p.removeMarkers=function(){p.removeMarker(l),p.removeMarker(c)},p.saveRange=function(){p.insertMarkers()},p.selectRange=function(e){f?(r.getSelection().removeAllRanges(),r.getSelection().addRange(e)):e.select()},p.restoreRange=function(){var e,t=p.selectedRange(),n=p.getMarker(l),r=p.getMarker(c);if(!n||!r||!t)return!1;f?(t=i.createRange(),t.setStartBefore(n),t.setEndAfter(r),p.selectRange(t)):(t=i.body.createTextRange(),e=i.body.createTextRange(),e.moveToElementText(n),t.setEndPoint("StartToStart",e),t.moveStart(h,0),e.moveToElementText(r),t.setEndPoint("EndToStart",e),t.moveEnd(h,0),p.selectRange(t)),p.removeMarkers()},a=function(e,t){var n=p.cloneSelected();if(!n)return!1;n.collapse(!1),f?(n.setStart(n.startContainer,n.startOffset-e),n.setEnd(n.endContainer,n.endOffset+t)):(n.moveStart(h,0-e),n.moveEnd(h,t)),p.selectRange(n)},u=function(e,t){var n="",r=p.cloneSelected();return r?(r.collapse(!1),e?f?(n=r.startContainer.textContent.substr(0,r.startOffset),n=n.substr(Math.max(0,n.length-t))):(r.moveStart(h,0-t),n=r.text):f?n=r.startContainer.textContent.substr(r.startOffset,t):(r.moveEnd(h,t),n=r.text),n):""},p.raplaceKeyword=function(t,n,r,i,s,o){r||t.sort(function(e,t){return e.length-t.length});var l,c,h,d,v,m,g,y,b=i||t[t.length-1][0].length;l=c=h="";if(s){if(!f)return!1;++b}l=u(!0,b),n&&(c=u(!1,b)),h=l+(o!=null?o:"")+c,d=t.length;while(d--){g=new RegExp("(?:[\\s    ])"+e.sceditor.regexEscape(t[d][0])+"(?=[\\s    ])"),y=l.length-1-t[d][0].length,s&&--y,y=Math.max(0,y);if(!s&&(v=h.indexOf(t[d][0],y))>-1||s&&(v=h.substr(y).search(g))>-1){s&&(v+=y+1);if(v>l.length||v+t[d][0].length+(s?1:0)<l.length)continue;return m=l.length-v,a(m,t[d][0].length-m-(o!=null&&/^\S/.test(o)?1:0)),p.insertHTML(t[d][1]),!0}}return!1}},e.sceditor.dom={traverse:function(e,t,n,r,i){if(e){e=i?e.lastChild:e.firstChild;while(e!=null){var s=i?e.previousSibling:e.nextSibling;if(!n&&t(e)===!1)return!1;if(!r&&this.traverse(e,t,n,r,i)===!1)return!1;if(n&&t(e)===!1)return!1;e=s}}},rTraverse:function(e,t,n,r){this.traverse(e,t,n,r,!0)},blockLevelList:"|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|",isInline:function(t,n){return!t||t.nodeType!==1?!0:(t=t.tagName.toLowerCase(),t==="code"?!n:e.sceditor.dom.blockLevelList.indexOf("|"+t+"|")<0)},copyCSS:function(e,t){t.style.cssText=e.style.cssText+t.style.cssText},fixNesting:function(e){var t=this,n=function(e){while(t.isInline(e.parentNode,!0))e=e.parentNode;return e};t.traverse(e,function(e){if(e.nodeType===1&&!t.isInline(e,!0)&&t.isInline(e.parentNode,!0)){var r=n(e),i=r.parentNode,s=t.extractContents(r,e),o=e;t.copyCSS(r,o),i.insertBefore(s,r),i.insertBefore(o,r)}})},findCommonAncestor:function(t,n){return e(t).parents().has(e(n)).first()},removeWhiteSpace:function(t){var n,r=/[^\S|\u00A0]+/g;this.traverse(t,function(t){n=t.nodeValue;if(t.nodeType===3&&e(t).parents("code, pre").length===0&&n){n=n.replace(/[\r\n]/,"");if(!n.length){t.parentNode.removeChild(t);return}/\S|\u00A0/.test(n)?r.test(n)&&(t.nodeValue=n.replace(r," ")):t.nodeValue=" "}})},extractContents:function(e,t){var n=this,r=n.findCommonAncestor(e,t),i=r?r.get(0):null,s=!1,o=!1;return function u(r){var i=e.ownerDocument.createDocumentFragment();return n.traverse(r,function(n){if(o||n===t&&s)return o=!0,!1;n===e&&(s=!0);var r,a;s?jQuery.contains(n,t)&&n.nodeType===1?(r=u(n),a=n.cloneNode(!1),a.appendChild(r),i.appendChild(a)):i.appendChild(n):jQuery.contains(n,e)&&n.nodeType===1&&(r=u(n),a=n.cloneNode(!1),a.appendChild(r),i.appendChild(a))},!1),i}(i)}},e.sceditor.command={get:function(t){return e.sceditor.commands[t]||null},set:function(t,n){return!t||!n?!1:(n=e.extend(e.sceditor.commands[t]||{},n),n.remove=function(){e.sceditor.command.remove(t)},e.sceditor.commands[t]=n,this)},remove:function(t){return e.sceditor.commands[t]&&delete e.sceditor.commands[t],this}},e.sceditor.defaultOptions={toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,youtube,date,time|ltr,rtl|print,source",style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:null,locale:"en",charset:"utf-8",emoticonsCompat:!1,emoticonsRoot:"",emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png"
,":wassat:":"emoticons/wassat.png"},hidden:{":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,resizeEnabled:!0,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:!0,resizeWidth:!0,getHtmlHandler:null,getTextHandler:null,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:!1,readOnly:!1,rtl:!1,autofocus:!1,autoExpand:!1,autoUpdate:!1,runWithoutWysiwygSupport:!1,id:null,plugins:"",parserOptions:{},dropDownCss:{}},e.fn.sceditor=function(t){var n,r=[];t=t||{};if(!t.runWithoutWysiwygSupport&&!e.sceditor.isWysiwygSupported)return;return this.each(function(){n=this.jquery?this:e(this);if(n.parents(".sceditor-container").length>0)return;t==="state"?r.push(!!n.data("sceditor")):t==="instance"?r.push(n.data("sceditor")):n.data("sceditor")||(t.plugins&&/bbcode/i.test(t.plugins)?new e.sceditorBBCodePlugin(n,t):new e.sceditor(this,t))}),r.length?r.length===1?r[0]:e(r):this}})(jQuery,window,document),function(e,t,n){"use strict";e.sceditor.BBCodeParser=function(t){if(!(this instanceof e.sceditor.BBCodeParser))return new e.sceditor.BBCodeParser(t);var r=this,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y={open:"open",content:"content",newline:"newline",close:"close"};Object.freeze&&Object.freeze(y);var b=function(e,t,n,r,i,s){var o=this;o.type=e,o.name=t,o.val=n,o.attrs=r||{},o.children=i||[],o.closing=s||null};b.prototype={clone:function(e){var t=this;return new b(t.type,t.name,t.val,t.attrs,e?t.children:[],t.closing?t.closing.clone():null)},splitAt:function(t){var n,r=this,i=0,s=r.children.length;typeof object!="number"&&(t=e.inArray(t,r.children));if(t<0||t>s)return null;while(s--)s>=t?i++:s=!1;return n=r.clone(),n.children=r.children.splice(t,i),n}},i=function(){r.opts=e.extend({},e.sceditor.BBCodeParser.defaults,t),r.bbcodes=e.sceditorBBCodePlugin.bbcodes},r.tokenize=function(e){var t,n,r,i=[],o=[{type:"close",regex:/^\[\/[^\[\]]+\]/},{type:"open",regex:/^\[[^\[\]]+\]/},{type:"newline",regex:/^(\r\n|\r|\n)/},{type:"content",regex:/^([^\[\r\n]+|\[)/}];o.reverse();e:while(e.length){r=o.length;while(r--){n=o[r].type;if(!(t=e.match(o[r].regex))||!t[0])continue;i.push(s(n,t[0])),e=e.substr(t[0].length);continue e}e.length&&i.push(s(y.content,e)),e=""}return i},s=function(t,n){var r,i,s;return t==="open"?(r=n.match(/\[([^\]\s=]+)(?:([^\]]+))?\]/),s=m(r[1]),r[2]&&(r[2]=e.trim(r[2]))&&(i=o(r[2]))):t==="close"?(r=n.match(/\[\/([^\[\]]+)\]/),s=m(r[1])):t==="newline"?s="#newline":s="#",new b(t,s,n,i)},o=function(t){var n,r=/(\S+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|([^'"\s]+))/g,i={};if(t.charAt(0)==="="&&t.split("=").length<=2)i.defaultattr=e.sceditorBBCodePlugin.stripQuotes(t.substr(1));else{t.charAt(0)==="="&&(t="defaultattr"+t);while(n=r.exec(t))i[m(n[1])]=n[3]||n[4]}return i},r.parse=function(e,t){var n=u(r.tokenize(e));return r.opts.fixInvalidChildren&&h(n),r.opts.removeEmptyTags&&c(n),r.opts.fixInvalidNesting&&f(n),a(n,null,t),r.opts.removeEmptyTags&&c(n),n},v=function(e,t,n){var r=n.length;while(r--)if(n[r].type===t&&n[r].name===e)return!0;return!1},l=function(t,n){var i=t?r.bbcodes[t.name]:null,s=i?i.allowedChildren:null;return!r.opts.fixInvalidChildren||!s?!0:s&&e.inArray(n.name||"#",s)<0?!1:!0},u=function(t){var n,i,s,o,u,a,f,l=[],c=[],h=[],p=function(){return g(h)},d=function(e){p()?p().children.push(e):c.push(e)},m=function(t){return p()&&(i=r.bbcodes[p().name])&&i.closedBy&&e.inArray(t,i.closedBy)>-1};while(n=t.shift()){f=t[0];switch(n.type){case y.open:m(n.name)&&h.pop(),d(n),i=r.bbcodes[n.name],(!i||!i.isSelfClosing)&&(i||v(n.name,y.close,t))&&h.push(n);break;case y.close:p()&&n.name!==p().name&&m(n.name)&&h.pop();if(p()&&n.name===p().name)p().closing=n,h.pop();else if(v(n.name,y.open,h)){while(s=h.pop()){if(s.name===n.name){s.closing=n;break}o=s.clone(),l.length>1&&o.children.push(g(l)),l.push(o)}d(g(l)),u=l.length;while(u--)h.push(l[u]);l.length=0}else n.type=y.content,d(n);break;case y.newline:p()&&f&&m(f.name)&&(f.type!==y.close||f.name!==p().name)&&(i=r.bbcodes[p().name],i&&i.breakAfter?h.pop():i&&i.isInline===!1&&r.opts.breakAfterBlock&&i.breakAfter!==!1&&h.pop()),d(n);break;default:d(n)}a=n}return c},a=function(e,t,n){var i,s,o,u,f,l,c,h,p,d=e.length,v=d;t&&(u=r.bbcodes[t.name]);while(v--){if(!(i=e[v]))continue;if(i.type===y.newline){s=v>0?e[v-1]:null,o=v<d-1?e[v+1]:null,p=!1,!n&&u&&u.isSelfClosing!==!0&&(v===0?(u.isInline===!1&&r.opts.breakStartBlock&&u.breakStart!==!1&&(p=!0),u.breakStart&&(p=!0)):!c&&d-1===v&&(u.isInline===!1&&r.opts.breakEndBlock&&u.breakEnd!==!1&&(p=!0),u.breakEnd&&(p=!0),c=p)),s&&s.type===y.open&&(f=r.bbcodes[s.name])&&(n?f.isInline===!1&&(p=!0):(f.isInline===!1&&r.opts.breakAfterBlock&&f.breakAfter!==!1&&(p=!0),f.breakAfter&&(p=!0)));if(!n&&!h&&o&&o.type===y.open)if(l=r.bbcodes[o.name]){l.isInline===!1&&r.opts.breakBeforeBlock&&l.breakBefore!==!1&&(p=!0),l.breakBefore&&(p=!0),h=p;if(p){e.splice(v,1);continue}}p&&e.splice(v,1),h=!1}else i.type===y.open&&a(i.children,i,n)}},f=function(t,n,i,s){var o,u,a,l,c,h,p=function(e){var t=r.bbcodes[e.name];return!t||t.isInline!==!1};n=n||[],s=s||t;for(u=0;u<t.length;u++){if(!(o=t[u])||o.type!==y.open)continue;if(!p(o)&&i){a=g(n),h=a.splitAt(o),c=n.length>1?n[n.length-2].children:s;if((l=e.inArray(a,c))>-1){h.children.splice(e.inArray(o,h.children),1),c.splice(l+1,0,o,h);return}}n.push(o),f(o.children,n,i||p(o),s),n.pop(o)}},h=function(e,t){var n,r,i=e.length;while(i--){if(!(n=e[i]))continue;l(t,n)||(n.name=null,n.type=y.content,l(t,n)?(r=[i+1,0].concat(n.children),n.closing&&(n.closing.name=null,n.closing.type=y.content,r.push(n.closing)),i+=r.length-1,Array.prototype.splice.apply(e,r)):t.children.splice(i,1)),n.type===y.open&&h(n.children,n)}},c=function(e){var t,n,i=e.length;while(i--){if(!(t=e[i])||t.type!==y.open)continue;n=r.bbcodes[t.name],c(t.children),t.children.length<1&&n&&!n.isSelfClosing&&!n.allowsEmpty&&e.splice(i,1)}},r.toHTML=function(e,t){return p(r.parse(e,t),!0)},p=function(t,i){var s,o,u,a,f,l,c,h,d=[];while(t.length>0){if(!(s=t.shift()))continue;if(s.type===y.open)o=r.bbcodes[s.name],c=!o||(typeof o.isHtmlInline!="undefined"?o.isHtmlInline:o.isInline),f=i&&(!o||c!==!1),u=p(s.children,!1),o&&o.html?(h=c===!1&&!o.isPreFormatted&&!o.skipLastLineBreak,h&&!e.sceditor.ie&&(u+="<br />"),e.isFunction(o.html)?a=o.html.call(r,s,s.attrs,u):a=e.sceditorBBCodePlugin.formatString(o.html,u)):a=s.val+u+(s.closing?s.closing.val:"");else{if(s.type===y.newline){if(!i){d.push("<br />");continue}if(l){d.push("</div>\n"),l=!1;continue}d.push("<div>"),e.sceditor.ie||d.push("<br />"),(n.documentMode&&n.documentMode<8||e.sceditor.ie<8)&&d.push(" "),d.push("</div>\n");continue}f=i,a=s.val.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}f&&!l?(d.push("<div>"),l=!0):!f&&l&&(d.push("</div>\n"),l=!1),d.push(a)}return l&&d.push("</div>\n"),d.join("")},r.toBBCode=function(e,t){return d(r.parse(e,t))},d=function(e){var t,n,i,s,o,u,a,f,l,c=[];while(e.length>0){if(!(t=e.shift()))continue;i=r.bbcodes[t.name],s=!!i&&i.isInline===!1,o=i&&i.isSelfClosing,u=s&&r.opts.breakBeforeBlock&&i.breakBefore!==!1||i&&i.breakBefore,a=s&&!o&&r.opts.breakStartBlock&&i.breakStart!==!1||i&&i.breakStart,f=s&&r.opts.breakEndBlock&&i.breakEnd!==!1||i&&i.breakEnd,l=s&&r.opts.breakAfterBlock&&i.breakAfter!==!1||i&&i.breakAfter;if(!i&&t.type===y.open)c.push(t.val),t.children&&c.push(d(t.children)),t.closing&&c.push(t.closing.val);else if(t.type===y.open){u&&c.push("\n"),c.push("["+t.name);if(t.attrs){t.attrs.defaultattr&&(c.push('="'+t.attrs.defaultattr+'"'),delete t.attrs.defaultattr);for(n in t.attrs)t.attrs.hasOwnProperty(n)&&c.push(" "+n+'="'+t.attrs[n]+'"')}c.push("]"),a&&c.push("\n"),t.children&&c.push(d(t.children)),!o&&!i.excludeClosing&&(f&&c.push("\n"),c.push("[/"+t.name+"]")),l&&c.push("\n"),t.closing&&o&&c.push(t.closing.val)}else c.push(t.val)}return c.join("")},g=function(e){return e.length?e[e.length-1]:null},m=function(e){return e.toLowerCase()},i()},e.sceditor.BBCodeParser.defaults={breakBeforeBlock:!1,breakStartBlock:!1,breakEndBlock:!1,breakAfterBlock:!0,removeEmptyTags:!0,fixInvalidNesting:!0,fixInvalidChildren:!0},e.sceditorBBCodePlugin=function(t,r){var i=this,s,o,u,a,f,l,c,h,p;f=e.sceditorBBCodePlugin.formatString,i.bbcodes=e.sceditorBBCodePlugin.bbcodes,i.stripQuotes=e.sceditorBBCodePlugin.stripQuotes;var d={},v={},m={ul:["li"],ol:["li"],table:["tr"],tr:["td","th"],code:["br","p","div"]},g={};s=function(){t.data("sceditorbbcode",i),i.opts=e.extend({},e.sceditor.defaultOptions,r),o(),new e.sceditor(t,e.extend({},i.opts,{getHtmlHandler:i.getHtmlHandler,getTextHandler:i.getTextHandler,commands:h()}))},h=function(){var t={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(t){var n=this;e.sceditor.command.get("font")._dropDown(n,t,function(e){n.insertText("[font="+e+"]","[/font]")})}},size:{txtExec:function(t){var n=this;e.sceditor.command.get("size")._dropDown(n,t,function(e){n.insertText("[size="+e+"]","[/size]")})}},color:{txtExec:function(t){var n=this;e.sceditor.command.get("color")._dropDown(n,t,function(e){n.insertText("[color="+e+"]","[/color]")})}},bulletlist:{txtExec:["[ul][li]","[/li][/ul]"]},orderedlist:{txtExec:["[ol][li]","[/li][/ol]"]},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(e,t){var n=prompt(this._("Enter the image URL:"),t);n&&this.insertText("[img]"+n+"[/img]")}},email:{txtExec:function(e,t){var n=t&&t.indexOf("@")>-1?null:t,r=prompt(this._("Enter the e-mail address:"),n?"":t),i=prompt(this._("Enter the displayed text:"),n||r)||r;r&&this.insertText("[email="+r+"]"+i+"[/email]")}},link:{txtExec:function(e,t){var n=t&&t.indexOf("http://")>-1?null:t,r=prompt(this._("Enter URL:"),n?"http://":t),i=prompt(this._("Enter the displayed text:"),n||r)||r;r&&this.insertText("[url="+r+"]"+i+"[/url]")}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(t){var n=this;e.sceditor.command.get("youtube")._dropDown(n,t,function(e){n.insertText("[youtube]"+e+"[/youtube]")})}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}};return e.extend(!0,{},t,e.sceditor.commands)},o=function(){e.each(i.bbcodes,function(t){typeof i.bbcodes[t].tags!="undefined"&&e.each(i.bbcodes[t].tags,function(e,n){var r=i.bbcodes[t].isInline===!1;d[e]=d[e]||{},d[e][r]=d[e][r]||{},d[e][r][t]=n}),typeof i.bbcodes[t].styles!="undefined"&&e.each(i.bbcodes[t].styles,function(e,n){var r=i.bbcodes[t].isInline===!1;v[r]=v[r]||{},v[r][e]=v[r][e]||{},v[r][e][t]=n})})},l=function(t,n){var r,i,s,o,u,a=t.style;return a?(g[n]||(g[n]=e.camelCase(n)),u=g[n],"text-align"===n?(r=e(t),s=a.direction,o=a[u]||r.css(n),r.parent().css(n)!==o&&r.css("display")==="block"&&!r.is("hr")&&!r.is("th")&&(i=o),s&&i&&(/right/i.test(i)&&s==="rtl"||/left/i.test(i)&&s==="ltr")?null:i):a[u]):null},c=function(e){var t=e.childNodes,n=t.length;if(e.nodeValue&&/\S|\u00A0/.test(e.nodeValue))return!1;if(t.length===0||t.length===1&&(/br/i.test(t[0].nodeName)||c(t[0])))return!0;while(n--)if(!c(t[n]))return!1;return!0},u=function(t,n,r){var s;return r=!!r,v[r]?(e.each(v[r],function(r,o){s=l(t[0],r);if(!s||l(t.parent()[0],r)===s)return;e.each(o,function(r,o){if(!/\S|\u00A0/.test(n)&&!i.bbcodes[r].allowsEmpty&&c(t[0]))return;if(!o||e.inArray(s.toString(),o)>-1)e.isFunction(i.bbcodes[r].format)?n=i.bbcodes[r].format.call(i,t,n):n=f(i.bbcodes[r].format,n)})}),n):n},a=function(t,n,r){var s=t[0].nodeName.toLowerCase();r=!!r,d[s]&&d[s][r]&&e.each(d[s][r],function(r,s){if(!/\S|\u00A0/.test(n)&&!i.bbcodes[r].allowsEmpty&&c(t[0]))return;if(s){var o=!1;e.each(s,function(n,r){if(!t.attr(n)||r&&e.inArray(t.attr(n),r)<0)return;return o=!0,!1});if(!o)return}e.isFunction(i.bbcodes[r].format)?n=i.bbcodes[r].format.call(i,t,n):n=f(i.bbcodes[r].format,n)});if(r&&(!e.sceditor.dom.isInline(t[0],!0)||s==="br")){var o=t[0].parentNode,u=t[0].previousSibling,a=e.sceditor.dom.isInline(o,!0)||o.nodeName.toLowerCase()==="body";if(a||s==="li"||o.lastChild!==t[0]||s==="br"&&e.sceditor.ie)n+="\n";"br"!==s&&!a&&u&&u.nodeType===3&&(n="\n"+n)}return n},i.getHtmlHandler=function(t,n){var r=new e.sceditor.BBCodeParser(i.opts.parserOptions);return e.sceditor.dom.removeWhiteSpace(n[0]),e.trim(r.toBBCode(i.elementToBbcode(n),!0))},i.elementToBbcode=function(t){return function n(t,r){var i="";return e.sceditor.dom.traverse(t,function(t){var s=e(t),o="",f=t.nodeName.toLowerCase(),l=m[f],c=!0;typeof r=="object"&&(c=e.inArray(f,r)>-1,c||(l=r));if(t.nodeType!==3){if(s.hasClass("sceditor-ignore"))return;f!=="iframe"&&(o=n(t,l)),c?(f!=="code"&&(o=u(s,o),o=a(s,o),o=u(s,o,!0)),i+=a(s,o,!0)):i+=o}else t.wholeText&&(!t.previousSibling||t.previousSibling.nodeType!==3)?s.parents("code").length===0?i+=t.wholeText.replace(/ +/g," "):i+=t.wholeText:t.wholeText||(i+=t.nodeValue)},!1,!0),i}(t.get(0))},i.getTextHandler=function(t,n){var r=new e.sceditor.BBCodeParser(i.opts.parserOptions),s=r.toHTML(t);return n?p(s):s},p=function(t){var r,i,s,o=e("<div />").hide().appendTo(n.body),u=o[0];u.innerHTML=t,r=u.firstChild;if(r&&r.nodeName.toLowerCase()==="div"){while(i=r.firstChild)u.insertBefore(i,r);e.sceditor.ie>=9&&u.insertBefore(n.createElement("br"),r),u.removeChild(r)}r=u.lastChild;if(r&&r.nodeName.toLowerCase()==="div"){while(i=r.firstChild)u.insertBefore(i,r);e.sceditor.ie>=9&&u.insertBefore(n.createElement("br"),r),u.removeChild(r)}return s=u.innerHTML,o.remove(),s},s()},e.sceditorBBCodePlugin.stripQuotes=function(e){return e.replace(/^(["'])(.*?)\1$/,"$2")},e.sceditorBBCodePlugin.formatString=function(){var e=arguments;return e[0].replace(/\{(\d+)\}/g,function(t,n){return typeof e[n-0+1]!="undefined"?e[n-0+1]:"{"+n+"}"})},e.sceditorBBCodePlugin.normaliseColour=function(e){function n(e){return e=parseInt(e,10),isNaN(e)?"00":(e=Math.max(0,Math.min(e,255)).toString(16),e.length<2?"0"+e:e)}var t;return(t=e.match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))?"#"+n(t[1])+n(t[2]-0)+n(t[3]-0):(t=e.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:e},e.sceditorBBCodePlugin.bbcodes={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},format:function(e,t){var n;if(e[0].nodeName.toLowerCase()!=="font"||!(n=e.attr("face")))n=e.css("font-family");return"[font="+this.stripQuotes(n)+"]"+t+"[/font]"},html:function(e,t,n){return'<font face="'+t.defaultattr+'">'+n+"</font>"}},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(e,t){var n=e.attr("size"),r=1;return n||(n=e.css("fontSize")),n.indexOf("px")>-1?(n=n.replace("px","")-0,n>12&&(r=2),n>15&&(r=3),n>17&&(r=4),n>23&&(r=5),n>31&&(r=6),n>47&&(r=7)):r=n,"[size="+r+"]"+t+"[/size]"},html:function(e,t,n){return'<font size="'+t.defaultattr+'">'+n+"</font>"}},color:{tags:{font:{color:null}},styles:{color:null},format:function(t,n){var r,i=t[0];if(i.nodeName.toLowerCase()!=="font"||!(r=t.attr("color")))r=i.style.color||t.css("color");return"[color="+e.sceditorBBCodePlugin.normaliseColour(r)+"]"+n+"[/color]"},html:function(e,t,n){return'<font color="'+t.defaultattr+'">'+n+"</font>"}},ul:{tags:{ul:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{breakStart:!0,isInline:!1,skipLastLineBreak:!0,html:"<ul>{0}</ul>"},ol:{tags:{ol:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},isInline:!1,closedBy:["ul","ol","list","*","li"],format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{isInline:!1,closedBy:["ul","ol","list","*","li"],html:"<li>{0}</li>"},table:{tags:{table:null},isInline:!1,isHtmlInline:!0,skipLastLineBreak:!0,format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},isInline:!1,skipLastLineBreak:!0,format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},allowsEmpty:!0,isInline:!1,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},allowsEmpty:!0,isInline:!1,format:"[td]{0}[/td]",html:"<td>{0}</td>"},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(e,t){return e.attr("data-sceditor-emoticon")+t},html:"{0}"},horizontalrule:{allowsEmpty:!0,tags:{hr:null},format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:!0,tags:{img:{src:null}},format:function(t,n){var r="",i=function(e){return t.style?t.style[e]:null};if(typeof t.attr("data-sceditor-emoticon")!="undefined")return n;if(t.attr("width")||t.attr("height")||i("width")||i("height"))r="="+e(t).width()+"x"+e(t).height();return"[img"+r+"]"+t.attr("src")+"[/img]"},html:function(e,t,n){var r,i="";return typeof t.width!="undefined"&&(i+=' width="'+t.width+'"'),typeof t.height!="undefined"&&(i+=' height="'+t.height+'"'),typeof t.defaultattr!="undefined"&&(r=t.defaultattr.split(/x/i),i=' width="'+r[0]+'"'+' height="'+(r.length===2?r[1]:r[0])+'"'),"<img"+i+' src="'+n+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},format:function(e,t){var n=e.attr("href");return n.substr(0,7)==="mailto:"?"[email="+n.substr(7)+"]"+t+"[/email]":"[url="+decodeURI(n)+"]"+t+"[/url]"},html:function(e,t,n){if(typeof t.defaultattr=="undefined"||t.defaultattr.length===0)t.defaultattr=n;return'<a href="'+encodeURI(t.defaultattr)+'">'+n+"</a>"}},email:{html:function(e,t,n){return typeof t.defaultattr=="undefined"&&(t.defaultattr=n),'<a href="mailto:'+t.defaultattr+'">'+n+"</a>"}},quote:{tags:{blockquote:null},isInline:!1,format:function(t,n){var r="",i=e(t),s=i.children("cite").first();if(s.length===1||i.data("author"))r=s.text()||i.data("author"),i.data("author",r),s.remove(),i.children("cite").replaceWith(function(){return e(this).text()}),n=this.elementToBbcode(e(t)),r="="+r;return"[quote"+r+"]"+n+"[/quote]"},html:function(e,t,n){return typeof t.defaultattr!="undefined"&&(n="<cite>"+t.defaultattr+"</cite>"+n),"<blockquote>"+n+"</blockquote>"}},code:{tags:{code:null},isInline:!1,allowedChildren:["#","#newline"],format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:!1,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:!1,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:!1,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:!1,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(e,t){return(e=e.attr("data-youtube-id"))?"[youtube]"+e+"[/youtube]":t},html:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{0}?wmode=opaque" data-youtube-id="{0}" frameborder="0" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},hr:{tags:{hr:null},isSelfClosing:!0,isInline:!1,format:"[hr]",html:"<hr />"},ignore:{}},e.sceditorBBCodePlugin.bbcode={get:function(t){return e.sceditorBBCodePlugin.bbcodes[t]||null},set:function(t,n){return!t||!n?!1:(n=e.extend(e.sceditorBBCodePlugin.bbcodes[t]||{},n),n.remove=function(){e.sceditorBBCodePlugin.bbcode.remove(t)},e.sceditorBBCodePlugin.bbcodes[t]=n,this)},rename:function(e,t){return this.hasOwnProperty(e)?(this[t]=this[e],this.remove(e),this):!1},remove:function(t){return e.sceditorBBCodePlugin.bbcodes[t]&&delete e.sceditorBBCodePlugin.bbcodes[t],this}},e.fn.sceditorBBCodePlugin=function(t){var n,r=[];t=t||{};if(!t.runWithoutWysiwygSupport&&!e.sceditor.isWysiwygSupported)return;return this.each(function(){n=this.jquery?this:e(this);if(n.parents(".sceditor-container").length>0)return;t==="state"?r.push(!!n.data("sceditor")):t==="instance"?r.push(n.data("sceditorbbcode")):n.data("sceditor")||new e.sceditorBBCodePlugin(n,t)}),r.length?r.length===1?r[0]:e(r):this}}(jQuery,window,document);